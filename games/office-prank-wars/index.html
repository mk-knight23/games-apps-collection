<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¢ Office Prank Wars - AI Enhanced</title>
  <link rel="stylesheet" href="../../assets/css/theme.css">
  <style>
    body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary)); }
    .game-wrapper { max-width: 900px; width: 100%; padding: 20px; }
    .game-title { font-size: 2.5rem; text-align: center; margin-bottom: 20px; background: linear-gradient(135deg, #3b82f6, #2563eb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .stats-panel { display: flex; justify-content: space-around; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
    canvas { width: 100%; border-radius: 12px; box-shadow: 0 8px 32px var(--shadow); display: block; }
    .pranks { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
    .prank-btn { padding: 15px; border-radius: 10px; font-size: 1rem; }
    .back-btn { position: fixed; top: 20px; left: 20px; padding: 12px 24px; border-radius: 8px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); cursor: pointer; backdrop-filter: blur(20px); }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="GameUtils.toggleTheme()"><span id="theme-icon">ğŸŒ™</span></button>
  <button class="back-btn" onclick="window.location.href='../../index.html'">â† Back</button>

  <div class="game-wrapper">
    <h1 class="game-title">ğŸ¢ Office Prank Wars</h1>
    <div class="stats-panel glass">
      <div><div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);" id="score">0</div><div>Score</div></div>
      <div><div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);" id="turn">1</div><div>Turn</div></div>
      <div><div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);" id="suspicion">0</div><div>Suspicion</div></div>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="pranks">
      <button class="btn prank-btn" onclick="doPrank('whoopee')">ğŸˆ Whoopee<br><small>+10 pts</small></button>
      <button class="btn prank-btn" onclick="doPrank('fake')">ğŸ“ Fake Call<br><small>+15 pts</small></button>
      <button class="btn prank-btn" onclick="doPrank('sticky')">ğŸ“ Sticky Notes<br><small>+20 pts</small></button>
      <button class="btn prank-btn" onclick="doPrank('keyboard')">âŒ¨ï¸ Keyboard<br><small>+25 pts</small></button>
      <button class="btn prank-btn" onclick="doPrank('airhorn')">ğŸ“¢ Airhorn<br><small>+30 pts</small></button>
      <button class="btn prank-btn" onclick="doPrank('jello')">ğŸ® Jello Desk<br><small>+40 pts</small></button>
    </div>
  </div>

  <script src="../../assets/js/game-utils.js"></script>
  <script src="../../assets/js/ai-assistant.js"></script>
  <script src="../../assets/js/analytics.js"></script>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const ai = new AIAssistant();
    const analytics = new GameAnalytics('office-prank');

    let game = {
      score: 0,
      turn: 1,
      suspicion: 0,
      players: [
        { x: 100, y: 300, emoji: 'ğŸ‘¨â€ğŸ’¼', name: 'You', score: 0 },
        { x: 400, y: 200, emoji: 'ğŸ‘©â€ğŸ’¼', name: 'AI 1', score: 0, isAI: true },
        { x: 700, y: 300, emoji: 'ğŸ§‘â€ğŸ’¼', name: 'AI 2', score: 0, isAI: true }
      ],
      boss: { x: 400, y: 100, emoji: 'ğŸ˜ ', patrol: 0 },
      particles: [],
      gameOver: false
    };

    const pranks = {
      whoopee: { points: 10, suspicion: 5, emoji: 'ğŸˆ' },
      fake: { points: 15, suspicion: 8, emoji: 'ğŸ“' },
      sticky: { points: 20, suspicion: 10, emoji: 'ğŸ“' },
      keyboard: { points: 25, suspicion: 15, emoji: 'âŒ¨ï¸' },
      airhorn: { points: 30, suspicion: 20, emoji: 'ğŸ“¢' },
      jello: { points: 40, suspicion: 30, emoji: 'ğŸ®' }
    };

    function init() {
      GameUtils.initTheme();
      document.getElementById('theme-icon').textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
      gameLoop();
      analytics.track('game_start');
    }

    function doPrank(type) {
      if (game.gameOver) return;
      
      const prank = pranks[type];
      game.score += prank.points;
      game.suspicion += prank.suspicion;
      game.particles.push(...GameUtils.createParticles(game.players[0].x, game.players[0].y, '#3b82f6', 20));
      GameUtils.playSound(800, 100);
      GameUtils.vibrate([50]);
      
      if (game.suspicion >= 100) {
        endGame();
        return;
      }

      // AI turns
      game.players.filter(p => p.isAI).forEach(p => {
        const aiPrank = Object.keys(pranks)[Math.floor(Math.random() * Object.keys(pranks).length)];
        p.score += pranks[aiPrank].points;
        game.particles.push(...GameUtils.createParticles(p.x, p.y, '#8b5cf6', 15));
      });

      game.turn++;
      game.suspicion = Math.max(0, game.suspicion - 5);
      
      document.getElementById('score').textContent = game.score;
      document.getElementById('turn').textContent = game.turn;
      document.getElementById('suspicion').textContent = game.suspicion;
    }

    function update() {
      if (game.gameOver) return;
      game.boss.patrol = (game.boss.patrol + 1) % 360;
      game.boss.x = 400 + Math.cos(game.boss.patrol * 0.05) * 200;
      game.particles = GameUtils.updateParticles(game.particles);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Office desks
      ctx.fillStyle = '#94a3b8';
      game.players.forEach(p => {
        ctx.fillRect(p.x - 30, p.y + 20, 60, 40);
      });

      // Players
      ctx.font = '50px Arial';
      ctx.textAlign = 'center';
      game.players.forEach(p => {
        ctx.fillText(p.emoji, p.x, p.y);
        ctx.font = '12px Arial';
        ctx.fillStyle = 'var(--text-primary)';
        ctx.fillText(`${p.name}: ${p.score}`, p.x, p.y + 50);
        ctx.font = '50px Arial';
      });

      // Boss
      ctx.fillText(game.boss.emoji, game.boss.x, game.boss.y);

      GameUtils.drawParticles(ctx, game.particles);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function endGame() {
      game.gameOver = true;
      analytics.endSession(game.score);
      GameUtils.saveScore('office-prank', game.score, { turn: game.turn });
      alert(`Game Over! Score: ${game.score}\n${ai.getRecommendation('office-prank')}`);
      window.location.href = '../../index.html';
    }

    init();
  </script>
</body>
</html>
